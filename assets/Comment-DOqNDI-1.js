import{i as c,b as f,u as d,q as p,j as e,d as x,L as g,l as E,r as I}from"./index-BM7gXiEi.js";import{M as _}from"./Message-CnKAuWI7.js";import{u as v}from"./useLastIdLocation-2wvBTfus.js";import{E as y}from"./ErrorMessageFetch-2ytYcsZd.js";import{u as N,t as S,I as M}from"./zod-CberE-wn.js";import{I as q}from"./IconButton-D6lSfURL.js";import{C as b}from"./Close-D6xosMpA.js";import{z as u}from"./index-ans_9-if.js";const L=u.object({content:u.string().min(1,"Comment should be at least 1 characters"),snippetId:u.string()});async function B(s){await c.post("/comments",s).catch(t=>{throw new Error(t.response.data.message)})}async function F(s,t){await c.patch(`/comments/${t}`,s).catch(n=>{throw new Error(n.response.data.message)})}async function P(s){const t={content:s.content,questionId:s.snippetId};await c.post("/answers",t).catch(n=>{throw new Error(n.response.data.message)})}const $=({snippetId:s,setStatus:t,commentString:n,commentId:o="",answerId:a=""})=>{var j;const m=f(r=>r.userState.username),{register:h,handleSubmit:w,formState:{errors:C}}=N({resolver:S(L)}),i=d({mutationFn:n?r=>F(r,o):B,onSuccess(){p.invalidateQueries({queryKey:[`snippets/${s}`]}),t(!1)}}),l=d({mutationFn:P,onSuccess(){p.invalidateQueries({queryKey:[`/questions/${a}`]}),t(!1)}});return e.jsxs("form",{className:"comment",onSubmit:w(r=>{if(s)return i.mutate(r);if(a)return l.mutate(r)}),children:[e.jsxs("div",{className:"comment__field comment__input",children:[i.isError||l.isError&&e.jsx(y,{mutation:i}),e.jsx(q,{classes:"close-btn",svg:e.jsx(b,{classes:"close-comment-svg",color:"grey"}),onClick:()=>t(!1)}),e.jsx("p",{className:"comment__text",children:m}),e.jsx(M,{placeholder:"Comment...",svg:e.jsx(_,{classes:"user-svg",color:"#5053f4"}),type:"text",inputProp:{...h("content")},errorMessage:(j=C.content)==null?void 0:j.message,newValue:n}),e.jsx("input",{className:"visually-hidden",type:"text",value:s||a,...h("snippetId")})]}),e.jsx(x.Button,{classes:"comment-send",children:i.isPending||l.isPending?e.jsx(g,{type:"small"}):"Send"})]})};async function k(s){await c.delete(`/comments/${s}`).catch(t=>{throw new Error(t.response.data.message)})}const z=({commentId:s,setStatus:t})=>{const n=v(),o=E(),a=d({mutationFn:()=>k(s),onSuccess(){p.invalidateQueries({queryKey:[`snippets/${n}`]})}});return o.pathname.includes("answers")?null:e.jsxs("div",{children:[a.isError&&e.jsx(y,{mutation:a}),e.jsx(x.Button,{classes:"comment__update",size:"small",variant:"text",onClick:()=>t(!0),children:"Edit"}),e.jsx(x.Button,{classes:"comment__update",size:"small",variant:"text",onClick:()=>a.mutate(),children:a.isPending?e.jsx(g,{type:"small"}):"Delete"})]})},H=({comment:s})=>{const t=f(m=>m.userState.id),[n,o]=I.useState(!1),a=v();return e.jsx("li",{children:n?e.jsx($,{commentString:s.content,setStatus:o,snippetId:a,commentId:s.id}):e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment__field field",children:[e.jsxs("div",{className:"field__top",children:[e.jsx("p",{className:"comment__text",children:s==null?void 0:s.user.username}),t===s.user.id&&e.jsx(z,{commentId:s.id,setStatus:o})]}),e.jsx("p",{children:s==null?void 0:s.content})]}),e.jsx("div",{className:"comment__img",children:e.jsx(_,{color:"white",classes:"comment__svg"})})]})})};export{H as C,$ as N};
//# sourceMappingURL=Comment-DOqNDI-1.js.map
